import{_ as s,c as n,o as a,a4 as p}from"./chunks/framework.DpC1ZpOZ.js";const g=JSON.parse('{"title":"CICD","description":"","frontmatter":{},"headers":[],"relativePath":"Deploy/CICD.md","filePath":"Deploy/CICD.md"}'),e={name:"Deploy/CICD.md"},i=p(`<h1 id="cicd" tabindex="-1">CICD <a class="header-anchor" href="#cicd" aria-label="Permalink to &quot;CICD&quot;">​</a></h1><h2 id="githubaction" tabindex="-1">GithubAction <a class="header-anchor" href="#githubaction" aria-label="Permalink to &quot;GithubAction&quot;">​</a></h2><h3 id="vitepress-自动化部署" tabindex="-1">VitePress 自动化部署 <a class="header-anchor" href="#vitepress-自动化部署" aria-label="Permalink to &quot;VitePress 自动化部署&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>name: Sync Blog</span></span>
<span class="line"><span></span></span>
<span class="line"><span>on:</span></span>
<span class="line"><span>  push:</span></span>
<span class="line"><span>    # push 代码的时候 哪个分支会受到影响 这里是 v1.0.0 分支</span></span>
<span class="line"><span>    branches:</span></span>
<span class="line"><span>      - main # 也可以设置为 main 分支</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 推送之后执行一系列的任务</span></span>
<span class="line"><span>jobs:</span></span>
<span class="line"><span>  build:</span></span>
<span class="line"><span>    runs-on: ubuntu-latest</span></span>
<span class="line"><span>    steps:</span></span>
<span class="line"><span>      # 获取代码</span></span>
<span class="line"><span>      - name: 迁出代码</span></span>
<span class="line"><span>        # 使用action库 action/checkout获取代码</span></span>
<span class="line"><span>        uses: actions/checkout@main</span></span>
<span class="line"><span>      # 安装Node环境</span></span>
<span class="line"><span></span></span>
<span class="line"><span>      - name: 安装node.js</span></span>
<span class="line"><span>        # 使用action库  actions/setup-node安装node</span></span>
<span class="line"><span>        uses: actions/setup-node@main</span></span>
<span class="line"><span>        with:</span></span>
<span class="line"><span>          node-version: lts/*</span></span>
<span class="line"><span></span></span>
<span class="line"><span>      # 安装依赖</span></span>
<span class="line"><span>      - name: 安装依赖</span></span>
<span class="line"><span>        run: npm install</span></span>
<span class="line"><span></span></span>
<span class="line"><span>      # 打包</span></span>
<span class="line"><span>      - name: 打包</span></span>
<span class="line"><span>        run: npm run build</span></span>
<span class="line"><span></span></span>
<span class="line"><span>      # 发布到 github-page</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>      - name: 发布到 github-page</span></span>
<span class="line"><span>        uses: peaceiris/actions-gh-pages@v3</span></span>
<span class="line"><span>        with:</span></span>
<span class="line"><span>          github_token: \${{ secrets.VITEPRESS_TOKEN }}</span></span>
<span class="line"><span>          exclude_assets: &#39;&#39;</span></span>
<span class="line"><span>          publish_dir: docs/.vitepress/dist</span></span>
<span class="line"><span></span></span>
<span class="line"><span>      # 上传到服务器</span></span>
<span class="line"><span>      - name: 发布到服务器</span></span>
<span class="line"><span>        uses: easingthemes/ssh-deploy@main</span></span>
<span class="line"><span>        env:</span></span>
<span class="line"><span>          # 私钥</span></span>
<span class="line"><span>          SSH_PRIVATE_KEY: \${{ secrets.PRIVATE_KEY }}</span></span>
<span class="line"><span>          # SCP参数</span></span>
<span class="line"><span>          ARGS: &quot;-avzr --delete&quot;</span></span>
<span class="line"><span>          # 源目录</span></span>
<span class="line"><span>          SOURCE: &quot;docs/.vitepress/dist/&quot;</span></span>
<span class="line"><span>          # 服务器ip</span></span>
<span class="line"><span>          REMOTE_HOST: \${{ secrets.REMOTE_HOST }}</span></span>
<span class="line"><span>          # 用户</span></span>
<span class="line"><span>          REMOTE_USER: &quot;root&quot;</span></span>
<span class="line"><span>          # 目标地址</span></span>
<span class="line"><span>          TARGET: &quot;/home/vitepress&quot;</span></span></code></pre></div><p>服务器需要配置密钥：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ssh-keygen</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -m</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> PEM</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rsa</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -b</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 4096</span></span></code></pre></div><p>赋值密钥到变量 PRIVATE_KEY，并设置服务器远程地址 REMOTE_HOST</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/.ssh/id_rsa</span></span></code></pre></div>`,8),l=[i];function t(c,o,h,d,r,u){return a(),n("div",null,l)}const _=s(e,[["render",t]]);export{g as __pageData,_ as default};
